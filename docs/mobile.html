<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Mobile Orientation Tracking</title>
		<meta charset="utf-8">
		<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon"/>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: black;
				margin: 0px;
				overflow: hidden;
                color: white;
			}
		</style>
    </head>
    <body>
        <div id="logOutput"></div>
        <script crossorigin="anonymous">
            const initClient = () => {
                
                const wsClient = new WebSocket('ws://10.200.1.52:1337');

                wsClient.onopen = function () {
                    // connection is opened and ready to use
                    log('on open');
                };

                wsClient.onerror = function (error) {
                    // an error occurred when sending/receiving data
                    log('on error ' + JSON.stringify(error, ["message", "arguments", "type", "name"]));
                };
                
                wsClient.onmessage = function (message) {
                    log('received message: ' + message.data);
                };

                return(wsClient);
            };

            const logOutput = document.getElementById('logOutput');

            const log = msg => {
                const now = new Date();
                const padLeft = value => value<10 ? "0"+value : value;

                logOutput.innerHTML += `<br/>${padLeft(now.getHours())}:${padLeft(now.getMinutes())}:${padLeft(now.getSeconds())} ${msg}`
            }

            let wsClient = initClient();

            window.addEventListener( 'deviceorientation', ev => {
                const {alpha, beta, gamma} = event;
                const msg = JSON.stringify({type:"device-orientation-change", data: {alpha, beta, gamma} });
                wsClient.send(msg);
            }, false );

            window.addEventListener( 'orientationchange', ev => {
                wsClient.send(JSON.stringify({type:"screen-orientation-change", data: window.orientation || 0 }));
            }, false );

        </script>
    </body>
</html>